fragment RegistrationWorkshop on Workshop {
  id
  type
  name
  slug

  picture {
    id
    medium
    blurhash
  }

  tutors {
    ...RegistrationTutor
  }

  sessions {
    id
    startsAt
  }
}

fragment RegistrationTutor on Person {
  id
  name
  city {
    id
    name
    traditionalName
  }
  country {
    id
    name
    traditionalName
  }
}

fragment RegistrationSlot on Slot {
  id
  startsAt
  endsAt

  workshops {
    ...RegistrationWorkshop
  }
}

fragment RegistrationPreference on Preference {
  id
  position
  slot {
    ...RegistrationSlot
  }
  workshop {
    ...RegistrationWorkshop
  }
}

fragment WorkshopDetails on Workshop {
  id
  type
  description

  picture {
    id
    large
  }

  tutors {
    id
    name
    bio
  }

  sessions {
    id
    startsAt

    venue {
      id
      room
      building
      address
    }
  }
}

fragment RegistrationUserDetails on Registration {
  user {
    id
    email
    profile {
      id
      name
      pronouns
      phone
      city {
        id
        name
        traditionalName
      }
      country {
        id
        name
        traditionalName
      }
    }
  }
  codeOfConductAcceptedAt
}

query WorkshopDetails($slug: String!) {
  festival {
    id

    activity(type: Workshop, slug: $slug) {
      id
      type
      ...WorkshopDetails
    }
  }
}

query RegistrationStatus {
  registration {
    id
    ...RegistrationUserDetails
    preferences {
      ...RegistrationPreference
    }
  }

  festival {
    id
    startDate
    endDate

    slots(type: Workshop) {
      ...RegistrationSlot
    }
  }
}

mutation UpdateRegistrationUserDetails($attributes: UserDetailsAttributes!) {
  updateRegistrationUserDetails(attributes: $attributes) {
    registration {
      id
      ...RegistrationUserDetails
    }
  }
}

mutation AddPreference($registrationId: ID, $sessionId: ID!) {
  addPreference(registrationId: $registrationId, sessionId: $sessionId) {
    preference {
      ...RegistrationPreference
    }
  }
}

mutation RemovePreference($registrationId: ID, $sessionId: ID!) {
  removePreference(registrationId: $registrationId, sessionId: $sessionId)
}
