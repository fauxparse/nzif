fragment WorkshopAllocationDetails on WorkshopAllocation {
  id
  state
  slots {
    id
    startsAt
    sessions {
      id
      capacity
      workshop {
        id
        name
      }
      registrations {
        id
      }
      waitlist {
        id
      }
    }
  }
}

query FestivalWorkshopAllocation {
  festival {
    id

    workshopAllocation {
      ...WorkshopAllocationDetails
    }

    registrations {
      id

      user {
        id
        profile {
          id
          name
        }
      }

      preferences {
        id
        position
        slot {
          id
        }
        workshop {
          id
        }
      }
    }
  }
}

mutation AllocateWorkshops {
  allocateWorkshops {
    workshopAllocation {
      ...WorkshopAllocationDetails
    }
  }
}

subscription allocationProgress($id: ID!) {
  jobProgress(jobName: "AllocateWorkshops", id: $id) {
    id
    state
    progress
    total
    error
  }
}
